{% extends "base.html" %}
{% block content %}

  {% include "includes/search_form.html" %}
    
  <div class="container">

    <div class="block_4 filter_actions">
    
      <button data-list="0" class="filter filter_active">
        <i class="fa fa-home"></i> All patients at <strong>{{ user.service.name }}</strong> <span class="filter-count">({{ all_patients | length }})</span>
      </button> 

      <button data-list="1" class="filter filter_sub">
        Completed outgoing referrals <span class="filter-count">({{ org_completed_referrals_outgoing.count() }})</span>
      </button>

      <button data-list="2" class="filter filter_sub">
        Open outgoing referrals <span class="filter-count">({{ org_open_referrals_outgoing.count() }})</span>
      </button>

      <button data-list="3" class="filter filter_sub">
        Completed incoming referrals <span class="filter-count">({{ org_completed_referrals_incoming.count() }})</span>
      </button>

      <button data-list="4" class="filter filter_sub">
        Open incoming referrals <span class="filter-count">({{ org_open_referrals_incoming.count() }})</span>
      </button>

      <button data-list="5" class="filter filter_sub">
        Patients with renewal notices <span class="filter-count">({{ org_need_renewal | length }})</span>
      </button>
      <button data-list="6" class="filter">
        <i class="fa fa-user"></i> <strong>Your</strong> recently updated patients <span class="filter-count">({{ your_recently_updated.count() }})</span>
      </button>
      <button data-list="7" class="filter filter_sub">
        Your completed outgoing referrals <span class="filter-count">({{ your_completed_referrals_outgoing.count() }})</span>
      </button>
      <button data-list="8" class="filter filter_sub">
        Your open outgoing referrals <span class="filter-count">({{ your_open_referrals_outgoing.count() }})</span>
      </button>
    </div>

    <div class="block_8 block_padding">
      {% for patient_list in [
        all_patients,
        org_completed_referrals_outgoing,
        org_open_referrals_outgoing,
        org_open_referrals_incoming,
        org_completed_referrals_incoming,
        org_need_renewal,
        your_recently_updated,
        your_completed_referrals_outgoing,
        your_open_referrals_outgoing
      ] %}
        <ul id="list-{{ loop.index - 1}}" class="list list_table list_filter {% if loop.index == 1 %} list_filter_active {% endif %}">
          {% for patient in patient_list %}
            <li class="list_row row">
              <a href="{{ url_for('screener.patient_overview', id=patient.id) }}">
                <span class="block_4">{{ patient.first_name }} {{ patient.last_name }}</span>
                
                {% if patient.last_modified_by %}
                <span class="block_4">{{ _("Last edited by") }} <strong>{{ patient.last_modified_by.full_name }} {{ _("at") }}</strong> {{ patient.last_modified_by.service.name }}</span>
                {% endif %}

                {{ patient_list.__name__ }}

              </a>
            </li>
          {% endfor %}
        </ul>   
      {% endfor %}
    </div>

  </div>
{% endblock %}

{% block script %}
<script>
  /*
  ** TEMPORARY SEARCH RESULTS
  ** used in /front/js/search.js
  **
  */
  window.temp = null;
  window.tempSearchData = {
    total: 0,
    list: []
  };

  {% for patient in all_patients %}
  temp = {
    name: '{% if patient.middle_name %} {{ patient.first_name ~ ' ' ~ patient.middle_name ~ ' ' ~ patient.last_name }} {% else %} {{ patient.first_name ~ ' ' ~ patient.last_name }} {% endif %}',
    dob: '{{ patient.dob }}',
    ssn: '{{ patient.ssn }}',
    url: '{{ url_for('screener.patient_overview', id=patient.id) }}'
  };
  tempSearchData.list.push(temp);
  tempSearchData.total++;
  window.newPatientUrl = "{{ url_for('screener.new_patient') }}" || '/new_patient';
  {% endfor %}
</script>
{% endblock %}